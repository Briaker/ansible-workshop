<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<!-- saved from url=(0047)https://docs.ansibleworkshop.com/exercise6.html -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="generator" content="AsciiDoc 8.6.8">
<title>Automation for Everyone</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}


#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="book">
<div id="header">
<h1>Automation for Everyone</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_table_of_contents">Table of Contents</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
<a href="https://docs.ansibleworkshop.com/index.html">Agenda</a>
</p>
</li>
<li>
<p>
<a href="https://docs.ansibleworkshop.com/exercise1.html">Exercise 1 - Configuring Ansible Tower</a>
</p>
</li>
<li>
<p>
<a href="https://docs.ansibleworkshop.com/exercise2.html">Exercise 2 - Ad-hoc commands in Tower</a>
</p>
</li>
<li>
<p>
<a href="https://docs.ansibleworkshop.com/exercise3.html">Exercise 3 - Writing Your First playbook</a>
</p>
</li>
<li>
<p>
<a href="https://docs.ansibleworkshop.com/exercise4.html">Exercise 4 - Creating and Running a Job Template</a>
</p>
</li>
<li>
<p>
<a href="https://docs.ansibleworkshop.com/exercise5.html">Exercise 5 - Using Variables, Loops, and Handlers</a>
</p>
</li>
<li>
<p>
<a href="https://docs.ansibleworkshop.com/exercise6.html">Exercise 6 - Roles: Making your playbooks reusable</a>
</p>
</li>
<li>
<p>
<a href="https://docs.ansibleworkshop.com/exercise7.html">Exercise 7 - Using Ansible for Windows Patching</a>
</p>
</li>
<li>
<p>
<a href="https://docs.ansibleworkshop.com/wrapup.html">Wrap UP</a>
</p>
</li>
</ul></div>
</div>
</div>
<h1 id="_exercise_6_roles_making_your_playbooks_reusable">Exercise 6 - Roles: Making your playbooks reusable</h1>
<div class="paragraph"><p>Although it is possible to write a playbook in one file as we’ve done throughout this workshop, eventually you’ll want to reuse files and start to organize things.</p></div>
<div class="paragraph"><p>Ansible Roles are the way we do this.  When you create a role, you deconstruct your playbook into parts and those parts sit in a directory structure.  This is considered best practice and will save you a lot of time in the future.</p></div>
<div class="paragraph"><p>For this exercise, you are going to take the playbook you just wrote and refactor it into a role.</p></div>
<div class="paragraph"><p>Let’s begin with seeing how your iis-basic-playbook will break down into a role…</p></div>
<div class="sect1">
<h2 id="_section_1_create_directory_structure_for_your_new_role">Section 1: Create directory structure for your new role</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_step_1">Step 1:</h3>
<div class="paragraph"><p>In Visual Studio Code, navigate to explorer and your <code>student#</code> project where you previously made iis_advanced.</p></div>
<div class="imageblock">
<div class="content">
<img src="./Automation for Everyone 6_files/6-vscode-existing-folders.png" alt="images/6-vscode-existing-folders.png" width="400">
</div>
<div class="title">Figure 1. iis_advanced</div>
</div>
<div class="paragraph"><p>Select the <strong>iis_advanced</strong> folder.</p></div>
<div class="paragraph"><p>Create a directory called <strong>roles</strong>  by right-clicking on iis_advanced and selecting <em>New Folder</em></p></div>
<div class="paragraph"><p>Now right-click <strong>roles</strong> and create a new folder underneath called <code>iis_simple</code>.</p></div>
</div>
<div class="sect2">
<h3 id="_step_2">Step 2:</h3>
<div class="paragraph"><p>Within <em>iis_simple</em> create new folders as follows:</p></div>
<div class="ulist"><ul>
<li>
<p>
defaults
</p>
</li>
<li>
<p>
vars
</p>
</li>
<li>
<p>
handlers
</p>
</li>
<li>
<p>
tasks
</p>
</li>
<li>
<p>
templates
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_step_3">Step 3:</h3>
<div class="paragraph"><p>Within each of these new folders (except templates), right-click and create <em>New File</em>
Create a file called <code>main.yml</code> in each of these folders.  You will not do this under templates as we will create individual template files.  This is your basic role structure and main.yml will be the default file that the role will use for each section.</p></div>
<div class="paragraph"><p>The finished structure will look like this:</p></div>
<div class="imageblock">
<div class="content">
<img src="./Automation for Everyone 6_files/6-create-role.png" alt="images/6-create-role.png" width="1000">
</div>
<div class="title">Figure 2. Role Structure</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_section_2_breaking_your_code_site_yml_code_playbook_into_the_newly_created_code_iis_simple_code_role">Section 2: Breaking Your <code>site.yml</code> Playbook into the Newly Created <code>iis_simple</code> Role</h2>
<div class="sectionbody">
<div class="paragraph"><p>In this section, we will separate out the major parts of your playbook including <code>vars:</code>, <code>tasks:</code>, <code>template:</code>, and <code>handlers:</code>.</p></div>
<div class="sect2">
<h3 id="_step_1_2">Step 1:</h3>
<div class="paragraph"><p>Make a backup copy of <code>site.yml</code>, then create a new <code>site.yml</code>.</p></div>
<div class="paragraph"><p>Navigate to your <code>iis_advanced</code> folder, right click <code>site.yml</code>, click <code>rename</code>, and call it <code>site.yml.backup</code></p></div>
<div class="paragraph"><p>Create a blank new file called <code>site.yml</code> in the same folder</p></div>
</div>
<div class="sect2">
<h3 id="_step_2_2">Step 2:</h3>
<div class="paragraph"><p>Update site.yml to look like to only call your role.  It should look like below:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>---
- hosts: Windows
  name: This is my role-based playbook

  roles:
    - iis_simple</code></pre>
</div></div>
<div class="imageblock">
<div class="content">
<img src="./Automation for Everyone 6_files/6-new-site.png" alt="images/6-new-site.png" width="1000">
</div>
<div class="title">Figure 3. New site.yml</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_2">Step 3:</h3>
<div class="paragraph"><p>Add a default variable to your role.  Edit the <code>roles\iis_simple\defaults\main.yml</code> as follows:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>---
# defaults file for iis_simple
iis_sites:
  - name: 'Ansible Playbook Test'
    port: '8080'
    path: 'C:\sites\playbooktest'
  - name: 'Ansible Playbook Test 2'
    port: '8081'
    path: 'C:\sites\playbooktest2'</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_step_4">Step 4:</h3>
<div class="paragraph"><p>Add some role-specific variables to your role in <code>roles\iis_simple\vars\main.yml</code>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>---
# vars file for iis_simple
iis_test_message: "Hello World!  My test IIS Server"</code></pre>
</div></div>
<div class="admonitionblock">
<table><tbody><tr>
<td class="icon">
<img src="./Automation for Everyone 6_files/note.png" alt="Note">
</td>
<td class="content">
<div class="paragraph"><p><strong>Hey, wait… did we just put variables in two seperate places?</strong><br></p></div>
<div class="paragraph"><p>Yes… yes we did.  Variables can live in quite a few places.  Just to name a few:<br></p></div>
<div class="ulist"><ul>
<li>
<p>
vars directory
</p>
</li>
<li>
<p>
defaults directory
</p>
</li>
<li>
<p>
group_vars directory
</p>
</li>
<li>
<p>
In the playbook under the <code>vars:</code> section
</p>
</li>
<li>
<p>
In any file which can be specified on the command line using the <code>--extra_vars</code> option
</p>
</li>
<li>
<p>
On a boat, in a moat, with a goat  <em>(disclaimer:  this is a complete lie)</em>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Bottom line, you need to read up on <a href="http://docs.ansible.com/ansible/latest/playbooks_variables.html#variable-precedence-where-should-i-put-a-variable">variable precedence</a> to understand both where to define variables and which locations take precedence.  In this exercise, we are using role defaults to define a couple of variables and these are the most malleable.  After that, we defined some variables in <code>/vars</code>
which have a higher precedence than defaults and can’t be overridden as a default variable.</p></div>
</td>
</tr></tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_step_5">Step 5:</h3>
<div class="paragraph"><p>Create your role handler in <code>roles\iis_simple\handlers\main.yml</code>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>---
# handlers file for iis_simple
- name: restart iis service
  win_service:
    name: W3Svc
    state: restarted
    start_mode: auto</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_step_6">Step 6:</h3>
<div class="paragraph"><p>Add tasks to your role in <code>roles\iis_simple\tasks\main.yml</code>.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>---
# tasks file for iis_simple

- name: Install IIS
  win_feature:
    name: Web-Server
    state: present

- name: Create site directory structure
  win_file:
    path: "{{ item.path }}"
    state: directory
  with_items: "{{ iis_sites }}"

- name: Create IIS site
  win_iis_website:
    name: "{{ item.name }}"
    state: started
    port: "{{ item.port }}"
    physical_path: "{{ item.path }}"
  with_items: "{{ iis_sites }}"
  notify: restart iis service

- name: Open port for site on the firewall
  win_firewall_rule:
    name: "iisport{{ item.port }}"
    enable: yes
    state: present
    localport: "{{ item.port }}"
    action: Allow
    direction: In
    protocol: Tcp
  with_items: "{{ iis_sites }}"

- name: Template simple web site to iis_site_path as index.html
  win_template:
    src: 'index.html.j2'
    dest: '{{ item.path }}\index.html'
  with_items: "{{ iis_sites }}"</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_step_7">Step 7:</h3>
<div class="paragraph"><p>Add your index.html template.</p></div>
<div class="paragraph"><p>Right-click <code>roles\iis_simple\templates</code> and create a new file called <code>index.html.j2</code> with the following content:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>&lt;html&gt;
&lt;body&gt;

  &lt;p align=center&gt;&lt;img src='http://docs.ansible.com/images/logo.png' align=center&gt;
  &lt;h1 align=center&gt;{{ ansible_hostname }} --- {{ iis_test_message }}

&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div></div>
<div class="paragraph"><p>Now, remember we still have a <em>templates</em> folder at the base level of this playbook, so we will delete that now.  Right click it and Select <em>Delete</em>.</p></div>
</div>
<div class="sect2">
<h3 id="_step_8_commit">Step 8: Commit</h3>
<div class="paragraph"><p>Click File → Save All to ensure all your files are saved.</p></div>
<div class="paragraph"><p>Click the Source Code icon as shown below (1).</p></div>
<div class="paragraph"><p>Type in a commit message like <code>Adding iis_simple role</code> (2) and click the check box above (3).</p></div>
<div class="imageblock">
<div class="content">
<img src="./Automation for Everyone 6_files/6-commit.png" alt="images/6-commit.png" width="1000">
</div>
<div class="title">Figure 4. Commit iis_simple_role</div>
</div>
<div class="paragraph"><p>Click the <code>synchronize changes</code> button on the blue bar at the bottom left.  This should again return with no problems.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_section_3_running_your_new_playbook">Section 3: Running your new playbook</h2>
<div class="sectionbody">
<div class="paragraph"><p>Now that you’ve successfully separated your original playbook into a role, let’s run it and see how it works.
We don’t need to create a new template, as we are re-using the one from Exercise 5.  When we run the template again, it
will automatically refresh from git and launch our new role.</p></div>
<div class="sect2">
<h3 id="_step_1_3">Step 1:</h3>
<div class="paragraph"><p>Before we can modify our Job Template, you must first go resync your Project again.  So do that now.</p></div>
</div>
<div class="sect2">
<h3 id="_step_2_3">Step 2:</h3>
<div class="paragraph"><p>Select TEMPLATES</p></div>
<div class="admonitionblock">
<table><tbody><tr>
<td class="icon">
<img src="./Automation for Everyone 6_files/note.png" alt="Note">
</td>
<td class="content">Alternatively, if you haven’t navigated away from the job templates creation page, you can scroll down to see all existing job templates</td>
</tr></tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_3">Step 3:</h3>
<div class="paragraph"><p>Click the rocketship icon <span class="image">
<img src="./Automation for Everyone 6_files/at_launch_icon.png" alt="Add">
</span> for the <strong>IIS Advanced</strong> Job Template.</p></div>
</div>
<div class="sect2">
<h3 id="_step_4_2">Step 4:</h3>
<div class="paragraph"><p>When prompted, enter your desired test message</p></div>
<div class="paragraph"><p>If successful, your standard output should look similar to the figure below.  Note that most of the tasks return OK because we’ve previously configured the servers and services are already running.</p></div>
<div class="imageblock">
<div class="content">
<img src="./Automation for Everyone 6_files/6-results.png" alt="images/6-results.png" width="1000">
</div>
<div class="title">Figure 5. Role site.yml stdout</div>
</div>
<div class="paragraph"><p>Once your job is successful, navigate again to your websites to verify they are still working (replace # with your student number)</p></div>
<div class="listingblock">
<div class="content">
<pre><code>http://s#-win1.ansibleworkshop.com:8080</code></pre>
</div></div>
<div class="paragraph"><p>and</p></div>
<div class="listingblock">
<div class="content">
<pre><code>http://s#-win1.ansibleworkshop.com:8081</code></pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_section_5_review">Section 5: Review</h2>
<div class="sectionbody">
<div class="paragraph"><p>You should now have a completed playbook, <code>site.yml</code> with a single role called <code>iis_simple</code>.  The advantage of structuring your playbook into roles is that you can now add reusability to your playbooks as well as simplifying changes to variables, tasks, templates, etc.</p></div>
<div class="paragraph"><p><a href="https://galaxy.ansible.com/">Ansible Galaxy</a> is a good repository of roles for use or reference.</p></div>
</div>
</div>
</div>

<div id="footer">
<div id="footer-text">
Last updated 2019-09-25 03:40:27 UTC
</div>
<div id="footer-badges">
<a href="http://validator.w3.org/check?uri=referer">
  <img style="border:0;width:88px;height:31px" src="./Automation for Everyone 6_files/valid-xhtml11-blue" alt="Valid XHTML 1.1" height="31" width="88">
</a>
<a href="http://jigsaw.w3.org/css-validator/">
  <img style="border:0;width:88px;height:31px" src="./Automation for Everyone 6_files/vcss-blue" alt="Valid CSS!">
</a>
</div>
</div>


</body></html>